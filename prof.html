<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beristales - Professional Mode</title>
<style>
body{
    font-family:'Segoe UI',sans-serif;
    background:#111;
    color:#eee;
    margin:0;padding:0;
    display:flex;flex-direction:column;align-items:center;
    min-height:100vh;
}
header{
    text-align:center;padding:30px 20px 10px;
}
header h1{font-size:2.8em;margin:0;}
header h2{font-size:1.3em;color:#ccc;margin:5px 0;}
#timer{font-size:1.2em;color:#f66;margin-top:10px;}

.typing-container{
    background:#222;
    padding:25px;
    border-radius:12px;
    box-shadow:0 8px 15px rgba(0,0,0,0.2);
    width:95%;
    max-width:900px;
    margin-top:20px;
    text-align:left;
    min-height:250px;
    overflow-wrap: break-word;
}

#drill-text{
    font-size:1.8em;
    line-height:1.6em;
    color:#eee;
    white-space:pre-wrap;
    word-wrap:break-word;
}

#drill-text span.correct{color:#4CAF50;}
#drill-text span.incorrect{color:#f55;}
#drill-text span.current{border-left:3px solid #fff;animation:blink 1s infinite;}
@keyframes blink{0%,50%{border-color:white;}50.01%,100%{border-color:transparent;}}

.overlay{
    position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);
    display:flex;justify-content:center;align-items:center;color:#fff;font-size:2em;flex-direction:column;display:none;
}
.overlay button{margin-top:20px;padding:10px 20px;font-size:0.8em;border:none;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>

<header>
<h1>Beristales - Professional Mode</h1>
<h2>Typing Challenge</h2>
<div id="timer">Time: 30s</div>
</header>

<div class="typing-container">
    <div id="drill-text"></div>

    <div class="overlay" id="result-overlay">
        <div id="result-text"></div>
        <button onclick="restartTest()">Restart</button>
    </div>
</div>

<script>
// --- Initial sentences ---
let sentences=[
"This is the first sentence, and it introduces the challenge.",
"The second sentence includes punctuation; observe commas and semicolons.",
"Now comes the third sentence: maintain focus and accuracy.",
"Fourth sentence: typing speed matters, but do not rush.",
"Finally, the fifth sentence concludes this practice session."
];
const invisibleWord=" "; // press space at end to finish

let spans=[];
let currentCharIndex=0;
let totalTyped=0;
let correctChars=0;
let startTime;
let timer=30;
let interval;
let testEnded=false;

// --- Render sentences dynamically ---
function renderSentences(){
    const container=document.getElementById("drill-text");
    container.innerHTML="";
    sentences.forEach(sentence=>{
        sentence.split("").forEach(char=>{
            const span=document.createElement("span");
            span.innerText=char;
            container.appendChild(span);
        });
        container.appendChild(document.createTextNode(" ")); // space between sentences
    });
    // add invisible word
    invisibleWord.split("").forEach(char=>{
        const span=document.createElement("span");
        span.innerText=char;
        container.appendChild(span);
    });

    spans=container.querySelectorAll("span");
    currentCharIndex=0;
    updatePointer();
}

// --- Pointer ---
function updatePointer(){
    spans.forEach((s,i)=>s.classList.remove("current"));
    if(!testEnded && spans[currentCharIndex]) spans[currentCharIndex].classList.add("current");
}

// --- Typing handling ---
document.addEventListener("keydown",e=>{
    if(testEnded) return;
    const key=e.key;
    if(["Shift","Control","Alt","Tab","CapsLock","Meta"].includes(key)) return;

    if(key.toLowerCase()==="backspace"){
        if(currentCharIndex>0){
            currentCharIndex--;
            const prevChar=spans[currentCharIndex].innerText;
            if(prevChar!==" ") correctChars--;
            spans[currentCharIndex].classList.remove("correct","incorrect");
            totalTyped--;
            updatePointer();
        }
        return;
    }

    if(currentCharIndex>=spans.length) return;

    const expected=spans[currentCharIndex].innerText;
    if(key===expected){spans[currentCharIndex].classList.add("correct"); if(expected!==" ") correctChars++;}
    else{spans[currentCharIndex].classList.add("incorrect"); totalTyped++;}

    currentCharIndex++;
    if(key!==" ") totalTyped++;

    // --- If user finishes all sentences before timer, add a new one ---
    if(currentCharIndex>=spans.length - invisibleWord.length){
        // Add new sentence dynamically
        const newSentence = generateNewSentence();
        sentences.push(newSentence);
        renderSentences();
    }

    updatePointer();
});

// --- Timer ---
function startTimer(){
    timer=30;
    document.getElementById("timer").innerText="Time: "+timer+"s";
    interval=setInterval(()=>{
        timer--;
        document.getElementById("timer").innerText="Time: "+timer+"s";
        if(timer<=0){
            clearInterval(interval);
            endTest();
        }
    },1000);
}

// --- End Test Overlay ---
function endTest(){
    testEnded=true;
    const minutes = 30/60;
    const typedWords = correctChars / 5; // only correct chars
    const wpm = Math.round(typedWords / minutes);
    const accuracy = Math.round((correctChars / totalTyped) * 100 || 0);
    const overlay = document.getElementById("result-overlay");
    document.getElementById("result-text").innerHTML=`WPM: ${wpm} <br> Accuracy: ${accuracy}%`;
    overlay.style.display="flex";
}

// --- Restart ---
function restartTest(){
    document.getElementById("result-overlay").style.display="none";
    sentences=[
        "This is the first sentence, and it introduces the challenge.",
        "The second sentence includes punctuation; observe commas and semicolons.",
        "Now comes the third sentence: maintain focus and accuracy.",
        "Fourth sentence: typing speed matters, but do not rush.",
        "Finally, the fifth sentence concludes this practice session."
    ];
    totalTyped=0;
    correctChars=0;
    currentCharIndex=0;
    testEnded=false;
    renderSentences();
    startTimer();
}

// --- Generate new intermediate sentence dynamically ---
function generateNewSentence(){
    const extras=[
        "Accuracy improves with persistent practice; keep typing!",
        "Challenging words like meticulous, eloquence, and juxtaposition appear now.",
        "Typing consistently builds speed, confidence, and focus over time.",
        "Observe punctuation and spacing carefully to avoid mistakes.",
        "Your fingers will adapt quickly to frequent practice sessions."
    ];
    return extras[Math.floor(Math.random()*extras.length)];
}

// --- Initialize ---
renderSentences();
startTimer();
</script>

</body>
</html>
